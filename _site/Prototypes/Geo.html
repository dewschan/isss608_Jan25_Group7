<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sei Sar Hla Kyi">
<meta name="dcterms.date" content="2025-03-21">

<title>Geospatial Prototypes – </title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-ddd961a2510921635943dfbbd19534c4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="../site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="../site_libs/plotly-binding-4.10.4/plotly.js"></script>

<script src="../site_libs/typedarray-0.1/typedarray.min.js"></script>

<script src="../site_libs/jquery-3.5.1/jquery.min.js"></script>

<link href="../site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="../site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

<link href="../site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">

<script src="../site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>



<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title"><img src="icon.png" style="height:40px;"></span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../Poster.html"> 
<span class="menu-text">Poster</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-prototypes" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Prototypes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-prototypes">    
        <li>
    <a class="dropdown-item" href="../Shiny/Data_Prep.html">
 <span class="dropdown-text">Data Preparation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Prototypes/Eda.html">
 <span class="dropdown-text">EDA &amp; CDA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Prototypes/Time.html">
 <span class="dropdown-text">Time Series Forecasting</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Prototypes/Geo.html">
 <span class="dropdown-text">Geospatial Analysis</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../Shiny/Prototype.html"> 
<span class="menu-text">Shiny App</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-team" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Team</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-team">    
        <li>
    <a class="dropdown-item" href="../Team.html">
 <span class="dropdown-text">The Team</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../NOM/Meeting Minutes 01.html">
 <span class="dropdown-text">Meeting Minutes 01</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../NOM/Meeting Minutes 02.html">
 <span class="dropdown-text">Meeting Minutes 02</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../NOM/Meeting Minutes 03.html">
 <span class="dropdown-text">Meeting Minutes 03</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../NOM/Meeting Minutes 04.html">
 <span class="dropdown-text">Meeting Minutes 04</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../NOM/Meeting Minutes 05.html">
 <span class="dropdown-text">Meeting Minutes 05</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../NOM/Meeting Minutes 06.html">
 <span class="dropdown-text">Meeting Minutes 06</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#r-packages-used" id="toc-r-packages-used" class="nav-link active" data-scroll-target="#r-packages-used">R Packages Used</a></li>
  <li><a href="#aspatial-data-wrangling" id="toc-aspatial-data-wrangling" class="nav-link" data-scroll-target="#aspatial-data-wrangling">Aspatial Data Wrangling</a>
  <ul class="collapse">
  <li><a href="#importing-the-data" id="toc-importing-the-data" class="nav-link" data-scroll-target="#importing-the-data">Importing the Data</a></li>
  <li><a href="#renaming-variables" id="toc-renaming-variables" class="nav-link" data-scroll-target="#renaming-variables">Renaming Variables</a></li>
  <li><a href="#date-field" id="toc-date-field" class="nav-link" data-scroll-target="#date-field">Date Field</a></li>
  <li><a href="#merging-columns" id="toc-merging-columns" class="nav-link" data-scroll-target="#merging-columns">Merging Columns</a></li>
  <li><a href="#converting-data-type" id="toc-converting-data-type" class="nav-link" data-scroll-target="#converting-data-type">Converting data type</a></li>
  <li><a href="#calculate-columns" id="toc-calculate-columns" class="nav-link" data-scroll-target="#calculate-columns">Calculate Columns</a></li>
  <li><a href="#remove-rows-with-no-date" id="toc-remove-rows-with-no-date" class="nav-link" data-scroll-target="#remove-rows-with-no-date">Remove rows with no date</a></li>
  <li><a href="#converting-aspatial-data-into-geospatial-data" id="toc-converting-aspatial-data-into-geospatial-data" class="nav-link" data-scroll-target="#converting-aspatial-data-into-geospatial-data">Converting aspatial data into geospatial data</a></li>
  <li><a href="#extract-data-for-geospatial-analysis" id="toc-extract-data-for-geospatial-analysis" class="nav-link" data-scroll-target="#extract-data-for-geospatial-analysis">Extract Data for Geospatial Analysis</a>
  <ul class="collapse">
  <li><a href="#set-timeframe" id="toc-set-timeframe" class="nav-link" data-scroll-target="#set-timeframe">Set Timeframe</a></li>
  <li><a href="#which-month-has-most-extreme-weather" id="toc-which-month-has-most-extreme-weather" class="nav-link" data-scroll-target="#which-month-has-most-extreme-weather">Which Month has most extreme weather?</a></li>
  <li><a href="#month-data-extraction" id="toc-month-data-extraction" class="nav-link" data-scroll-target="#month-data-extraction">Month Data Extraction</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#geospatial-data" id="toc-geospatial-data" class="nav-link" data-scroll-target="#geospatial-data">Geospatial Data</a></li>
  <li><a href="#spatial-interpolation" id="toc-spatial-interpolation" class="nav-link" data-scroll-target="#spatial-interpolation">Spatial Interpolation</a>
  <ul class="collapse">
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">Data Preparation</a></li>
  <li><a href="#manual-variogram" id="toc-manual-variogram" class="nav-link" data-scroll-target="#manual-variogram">Manual Variogram</a></li>
  <li><a href="#autovariogram" id="toc-autovariogram" class="nav-link" data-scroll-target="#autovariogram">AutoVariogram</a></li>
  </ul></li>
  <li><a href="#prototype-1-spatial-interpolation" id="toc-prototype-1-spatial-interpolation" class="nav-link" data-scroll-target="#prototype-1-spatial-interpolation">Prototype 1: Spatial Interpolation</a>
  <ul class="collapse">
  <li><a href="#shiny-ui" id="toc-shiny-ui" class="nav-link" data-scroll-target="#shiny-ui">Shiny UI</a></li>
  <li><a href="#shiny-app-prototype-1" id="toc-shiny-app-prototype-1" class="nav-link" data-scroll-target="#shiny-app-prototype-1">Shiny App Prototype 1</a></li>
  </ul></li>
  <li><a href="#local-measure-of-spatial-autocorrelation" id="toc-local-measure-of-spatial-autocorrelation" class="nav-link" data-scroll-target="#local-measure-of-spatial-autocorrelation">Local Measure of Spatial Autocorrelation</a>
  <ul class="collapse">
  <li><a href="#data-prep" id="toc-data-prep" class="nav-link" data-scroll-target="#data-prep">Data Prep</a></li>
  <li><a href="#raw-data---before-spatial-interpolation" id="toc-raw-data---before-spatial-interpolation" class="nav-link" data-scroll-target="#raw-data---before-spatial-interpolation">Raw Data - Before Spatial Interpolation</a></li>
  <li><a href="#after-spatial-interpolation" id="toc-after-spatial-interpolation" class="nav-link" data-scroll-target="#after-spatial-interpolation">After Spatial Interpolation</a></li>
  </ul></li>
  <li><a href="#prototype-2-local-measure-of-spatial-autocorrelation" id="toc-prototype-2-local-measure-of-spatial-autocorrelation" class="nav-link" data-scroll-target="#prototype-2-local-measure-of-spatial-autocorrelation">Prototype 2: Local Measure of Spatial Autocorrelation</a>
  <ul class="collapse">
  <li><a href="#shiny-ui-1" id="toc-shiny-ui-1" class="nav-link" data-scroll-target="#shiny-ui-1">9.1 Shiny UI</a></li>
  <li><a href="#shiny-app-prototype-2" id="toc-shiny-app-prototype-2" class="nav-link" data-scroll-target="#shiny-app-prototype-2">Shiny App Prototype 2</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Geospatial Prototypes</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Sei Sar Hla Kyi </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 21, 2025</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">April 3, 2025</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="r-packages-used" class="level1">
<h1>R Packages Used</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Packages Used</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Code to Launch</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Package</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>tidyverse</td>
<td>to efficiently manipulate and clean data, utilizing functions from packages like <code>dplyr</code> and <code>tidyr</code> for data wrangling</td>
</tr>
<tr class="even">
<td>SmartEDA</td>
<td>to help summarize dataset by providing insights such as missing values</td>
</tr>
<tr class="odd">
<td>sf</td>
<td>for easy manipulation of spatial objects and performing geospatial analysis</td>
</tr>
<tr class="even">
<td>plotly</td>
<td>for dynamically exploring climate trends over time</td>
</tr>
<tr class="odd">
<td>terra</td>
<td>for handling raster data and performing geospatial analysis in R</td>
</tr>
<tr class="even">
<td>gstat</td>
<td>for geostatistical modeling, including functions for spatial interpolation, variogram modeling, and kriging</td>
</tr>
<tr class="odd">
<td>automap</td>
<td>to simplifies the process of spatial interpolation by automating model selection, variogram fitting, and kriging</td>
</tr>
</tbody>
</table>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse,SmartEDA,sf,sfdep,plotly,tmap,terra,gstat,automap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<hr>
</section>
<section id="aspatial-data-wrangling" class="level1">
<h1>Aspatial Data Wrangling</h1>
<section id="importing-the-data" class="level2">
<h2 class="anchored" data-anchor-id="importing-the-data">Importing the Data</h2>
<p>We import the scraped data by using <em>read_csv</em> from readr package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>weather<span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/combined_weather_data.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will see the format of the imported data and check if there are any missing values using ExpData from SmartEDA package.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">type 1: Overall data summary</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">type 2: Variable level summary</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>Complete cases shows us if there are missing values. 100% means there is no missing values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>weather <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ExpData</span>(<span class="at">type=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                          Descriptions      Value
1                                   Sample size (nrow)     446491
2                              No. of variables (ncol)         16
3                    No. of numeric/interger variables          3
4                              No. of factor variables          0
5                                No. of text variables         13
6                             No. of logical variables          0
7                          No. of identifier variables          0
8                                No. of date variables          0
9             No. of zero variance variables (uniform)          0
10               %. of variables having complete cases    25% (4)
11   %. of variables having &gt;0% and &lt;50% missing cases 56.25% (9)
12 %. of variables having &gt;=50% and &lt;90% missing cases 18.75% (3)
13          %. of variables having &gt;=90% missing cases     0% (0)</code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>This further break down by variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>weather <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ExpData</span>(<span class="at">type=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Index                 Variable_Name Variable_Type Sample_n Missing_Count
1      1                       Station     character   446491             0
2      2                          Year       numeric   445641           850
3      3                         Month       numeric   445641           850
4      4                           Day       numeric   445641           850
5      5     Daily Rainfall Total (mm)     character   446491             0
6      6  Highest 30 min Rainfall (mm)     character   173989        272502
7      7  Highest 60 min Rainfall (mm)     character   173989        272502
8      8 Highest 120 min Rainfall (mm)     character   173989        272502
9      9         Mean Temperature (°C)     character   446491             0
10    10      Maximum Temperature (°C)     character   446256           235
11    11      Minimum Temperature (°C)     character   446244           247
12    12        Mean Wind Speed (km/h)     character   446491             0
13    13         Max Wind Speed (km/h)     character   446217           274
14    14  Highest 30 Min Rainfall (mm)     character   272502        173989
15    15  Highest 60 Min Rainfall (mm)     character   272502        173989
16    16 Highest 120 Min Rainfall (mm)     character   272502        173989
   Per_of_Missing No_of_distinct_values
1           0.000                    63
2           0.002                    21
3           0.002                    12
4           0.002                    31
5           0.000                  1478
6           0.610                   477
7           0.610                   609
8           0.610                   719
9           0.000                   106
10          0.001                   159
11          0.001                   116
12          0.000                   326
13          0.001                   576
14          0.390                   414
15          0.390                   545
16          0.390                   637</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="renaming-variables" class="level2">
<h2 class="anchored" data-anchor-id="renaming-variables">Renaming Variables</h2>
<p>Variable names will be renamed for consistency and ease of analysis. For instance, <strong>“Daily Rainfall Total (mm)”</strong> will be renamed to <strong>“DailyRainfall”</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(weather) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Station"</span>, <span class="st">"Year"</span>, <span class="st">"Month"</span>, <span class="st">"Day"</span>, </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"DailyRainfall"</span>, <span class="st">"Highest30minRainfall.x"</span>,<span class="st">"Highest60minRainfall.x"</span>,<span class="st">"Highest120minRainfall.x"</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"MeanTemperature"</span>, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"MaxTemperature"</span>, <span class="st">"MinTemperature"</span>, </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"MeanWindSpeed"</span>, <span class="st">"MaxWindSpeed"</span>, </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Highest30minRainfall.y"</span>,<span class="st">"Highest60minRainfall.y"</span>,<span class="st">"Highest120minRainfall.y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="date-field" class="level2">
<h2 class="anchored" data-anchor-id="date-field">Date Field</h2>
<p>Now we must ensure that Year, Month and Day fields are represented as numeric and combined as Date column by using <em>as.Date</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>weather <span class="ot">&lt;-</span> weather <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Year =</span> <span class="fu">as.numeric</span>(Year),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Month =</span> <span class="fu">as.numeric</span>(Month),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Day =</span> <span class="fu">as.numeric</span>(Day),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Date =</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(Year, Month, Day, <span class="at">sep =</span> <span class="st">"-"</span>), <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="merging-columns" class="level2">
<h2 class="anchored" data-anchor-id="merging-columns">Merging Columns</h2>
<p>The columns <strong><code>Highest30minRainfall.x</code></strong> and <strong><code>Highest30minRainfall.y</code></strong> need to be merged into a single column. Whenever one of these columns has an <code>NA</code> value, the other column will have a valid value, meaning that together they form the complete dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the columns and replace any remaining NA or "-" with 0</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>weather <span class="ot">&lt;-</span> weather <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Highest30minRainfall =</span> <span class="fu">coalesce</span>(<span class="st">`</span><span class="at">Highest30minRainfall.x</span><span class="st">`</span>, <span class="st">`</span><span class="at">Highest30minRainfall.y</span><span class="st">`</span>),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Highest60minRainfall =</span> <span class="fu">coalesce</span>(<span class="st">`</span><span class="at">Highest60minRainfall.x</span><span class="st">`</span>, <span class="st">`</span><span class="at">Highest60minRainfall.y</span><span class="st">`</span>),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Highest120minRainfall =</span> <span class="fu">coalesce</span>(<span class="st">`</span><span class="at">Highest120minRainfall.x</span><span class="st">`</span>, <span class="st">`</span><span class="at">Highest120minRainfall.y</span><span class="st">`</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert "-" to NA, then replace NA with 0</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Highest30minRainfall =</span> <span class="fu">as.numeric</span>(Highest30minRainfall), </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Highest30minRainfall =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Highest30minRainfall), <span class="dv">0</span>, Highest30minRainfall),</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">Highest60minRainfall =</span> <span class="fu">as.numeric</span>(Highest60minRainfall), </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">Highest60minRainfall =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Highest60minRainfall), <span class="dv">0</span>, Highest60minRainfall),</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">Highest120minRainfall =</span> <span class="fu">as.numeric</span>(Highest120minRainfall), </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">Highest120minRainfall =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Highest120minRainfall), <span class="dv">0</span>, Highest120minRainfall)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Drop the original columns</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">`</span><span class="at">Highest30minRainfall.x</span><span class="st">`</span>, <span class="st">`</span><span class="at">Highest30minRainfall.y</span><span class="st">`</span>, </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">Highest60minRainfall.x</span><span class="st">`</span>, <span class="st">`</span><span class="at">Highest60minRainfall.y</span><span class="st">`</span>, </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">Highest120minRainfall.x</span><span class="st">`</span>, <span class="st">`</span><span class="at">Highest120minRainfall.y</span><span class="st">`</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="converting-data-type" class="level2">
<h2 class="anchored" data-anchor-id="converting-data-type">Converting data type</h2>
<p>Upon inspecting the dataset, we observed that certain columns, such as <strong>Daily Rainfall Total (mm)</strong> and <strong>Mean Temperature (°C)</strong>, were incorrectly classified as <strong>character</strong> variables instead of numeric. To ensure accurate analysis, these columns will be converted to <strong>numeric</strong> data types.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert columns 5 to 10 to numeric</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>weather[, <span class="dv">5</span><span class="sc">:</span><span class="dv">10</span>] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(weather[, <span class="dv">5</span><span class="sc">:</span><span class="dv">10</span>], <span class="cf">function</span>(x) {</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>(x)  <span class="co"># Convert to numeric</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calculate-columns" class="level2">
<h2 class="anchored" data-anchor-id="calculate-columns">Calculate Columns</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>weather <span class="ot">&lt;-</span> weather <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Station) <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">MonthlyRainfall =</span> <span class="fu">sum</span>(DailyRainfall, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="remove-rows-with-no-date" class="level2">
<h2 class="anchored" data-anchor-id="remove-rows-with-no-date">Remove rows with no date</h2>
<p>Rows with no date will not be helpful for our analysis in later sections. Therefore, we will be removing these rows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>weather<span class="ot">&lt;-</span> weather[<span class="sc">!</span><span class="fu">is.na</span>(weather<span class="sc">$</span>Date), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="converting-aspatial-data-into-geospatial-data" class="level2">
<h2 class="anchored" data-anchor-id="converting-aspatial-data-into-geospatial-data">Converting aspatial data into geospatial data</h2>
<p>First, we will import station.csv which contains the longitude and latitude of each of the stations from our scraped data. We extracted this from the same website.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>stations<span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/stations.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Left join each station’s longitude/latitude data to weather dataframe by using the common column “Station.”</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>weather <span class="ot">&lt;-</span> stations <span class="sc">%&gt;%</span>   <span class="fu">left_join</span>(weather, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Station"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Convert to sf using <em>sf</em> package. s<em>vy21</em> is the official projected coordinates of Singapore. <em>3414</em> is the EPSG code of svy21.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>weather_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(weather, </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"Longitude"</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Latitude"</span>),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">crs=</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="extract-data-for-geospatial-analysis" class="level2">
<h2 class="anchored" data-anchor-id="extract-data-for-geospatial-analysis">Extract Data for Geospatial Analysis</h2>
<section id="set-timeframe" class="level3">
<h3 class="anchored" data-anchor-id="set-timeframe">Set Timeframe</h3>
<p>First we filter the dataset from Janurary 2021 to April 2024 since there are the most data recorded during these months, using the code chunk below.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Shiny App Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This will be only used later for development of Shiny App prototype!</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>weather_filtered <span class="ot">&lt;-</span> weather_sf <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>((Year <span class="sc">&gt;</span> <span class="dv">2021</span> <span class="sc">|</span> (Year <span class="sc">==</span> <span class="dv">2021</span> <span class="sc">&amp;</span> Month <span class="sc">&gt;=</span> <span class="dv">1</span>)) <span class="sc">&amp;</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>         (Year <span class="sc">&lt;</span> <span class="dv">2024</span> <span class="sc">|</span> (Year <span class="sc">==</span> <span class="dv">2024</span> <span class="sc">&amp;</span> Month <span class="sc">&lt;=</span> <span class="dv">4</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We then save it as a rds file using <em>write_rds</em> and <em>read_rds</em> to load it.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Save</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Load</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(weather_filtered, <span class="st">"data/rds/weather_filtered.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>weather_filtered <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/weather_filtered.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="which-month-has-most-extreme-weather" class="level3">
<h3 class="anchored" data-anchor-id="which-month-has-most-extreme-weather">Which Month has most extreme weather?</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Shiny App Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>For the purpose of this take-home exercise, we will focus on one month. Users will be able to choose different Months and Years in Shiny app.</p>
</div>
</div>
<p>To see which month is the most interesting to focus on we determine the month with the most extremeweather conditions based on three key factors from our dataframe. We created a new variable to measure the extremeness (‘ExtremeIndex’) by finding the following:</p>
<ol type="1">
<li><p><strong>Total Monthly Rainfall</strong> → Measures overall precipitation, indicating wet/extreme months.</p></li>
<li><p><strong>Mean of Temperature Variance</strong> → Measures temperature fluctuations (Max - Min), capturing extreme hot/cold changes.</p></li>
<li><p><strong>Max of Highest Wind Speed</strong> → Captures the strongest winds, which indicate stormy or extreme conditions.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>weather_extreme <span class="ot">&lt;-</span> weather <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Year, Month) <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">MonthlyRainfall =</span> <span class="fu">sum</span>(DailyRainfall, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">TempVariance =</span> <span class="fu">mean</span>(MaxTemperature<span class="sc">-</span>MinTemperature, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">MaxWindSpeed =</span> <span class="fu">max</span>(MaxWindSpeed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ExtremeIndex =</span> <span class="fu">scale</span>(MonthlyRainfall) <span class="sc">+</span> <span class="fu">scale</span>(TempVariance) <span class="sc">+</span> <span class="fu">scale</span>(MaxWindSpeed))</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>most_extreme_month <span class="ot">&lt;-</span> weather_extreme <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ExtremeIndex <span class="sc">==</span> <span class="fu">max</span>(ExtremeIndex))</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(weather_extreme, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(Year, Month, <span class="st">"01"</span>, <span class="at">sep =</span> <span class="st">"-"</span>)), <span class="at">y =</span> ExtremeIndex)) <span class="sc">+</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">text =</span> <span class="fu">paste</span>(<span class="st">"Month:"</span>, Month, Year, <span class="st">"&lt;br&gt;Extreme Index:"</span>, <span class="fu">round</span>(ExtremeIndex, <span class="dv">2</span>)))) <span class="sc">+</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Extreme Weather Index Over Time"</span>,</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Time (Month)"</span>,</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Extreme Weather Index"</span>) <span class="sc">+</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(p, <span class="at">tooltip =</span> <span class="st">"text"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-5345ba27572f02145925" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-5345ba27572f02145925">{"x":{"data":[{"x":[12784,12815,12843,12874,12904,12935,12965,12996,13027,13057,13088,13118,13149,13180,13208,13239,13269,13300,13330,13361,13392,13422,13453,13483,13514,13545,13573,13604,13634,13665,13695,13726,13757,13787,13818,13848,13879,13910,13939,13970,14000,14031,14061,14092,14123,14153,14184,14214,14245,14276,14304,14335,14365,14396,14426,14457,14488,14518,14549,14579,14610,14641,14669,14700,14730,14761,14791,14822,14853,14883,14914,14944,14975,15006,15034,15065,15095,15126,15156,15187,15218,15248,15279,15309,15340,15371,15400,15431,15461,15492,15522,15553,15584,15614,15645,15675,15706,15737,15765,15796,15826,15857,15887,15918,15949,15979,16010,16040,16071,16102,16130,16161,16191,16222,16252,16283,16314,16344,16375,16405,16436,16467,16495,16526,16556,16587,16617,16648,16679,16709,16740,16770,16801,16832,16861,16892,16922,16953,16983,17014,17045,17075,17106,17136,17167,17198,17226,17257,17287,17318,17348,17379,17410,17440,17471,17501,17532,17563,17591,17622,17652,17683,17713,17744,17775,17805,17836,17866,17897,17928,17956,17987,18017,18048,18078,18109,18140,18170,18201,18231,18262,18293,18322,18353,18383,18414,18444,18475,18506,18536,18567,18597,18628,18659,18687,18718,18748,18779,18809,18840,18871,18901,18932,18962,18993,19024,19052,19083,19113,19144,19174,19205,19236,19266,19297,19327,19358,19389,19417,19448,19478,19509,19539,19570,19601,19631,19662,19692,19723,19754,19783,19814,19844,19875,19905,19936,19967,19997,20028,20058,20089],"y":[-1.8951734852048394,0.84167689165559834,0.012224008098501438,0.10535538167803882,0.28817211306559587,-1.8795309155112627,-0.90985291321713069,-2.2979343741845542,-0.48925721648594189,-0.16875617778068086,-1.781150881297032,-0.88185310603501632,-1.6287555148834958,-1.4719290235409785,0.58399979341342689,0.23429118121511316,-1.2874671437750247,-2.2280230029789556,-2.2814540453113108,-1.3407797778910129,-2.0211155293446064,-1.5519735255951794,-0.0040503910196685311,-0.64583703557847594,-2.1968404987490744,-0.72186409162024434,-0.38047496220721455,0.69225321347070634,-0.5361180754349163,-1.0196157228478362,-2.8269644605880293,-1.5224182742281727,-1.8164598697820928,-0.63085843900168981,-1.1907602737686784,-1.5185641487625936,-1.7684974062857526,-1.5171601178062821,-1.8168268690728182,-0.69047480024834673,-1.662811411191381,-1.6324126657062492,-3.0778017432931555,-1.7255601115273116,-0.64672613087772046,-1.4603696683213729,-0.79038363684532575,-2.2037461505045788,-1.9596833883328857,0.16961420316297154,1.3169380717862893,1.5413309497198082,0.26782710409282329,-2.1927398379217133,-1.3094036638328335,-1.4090678276390749,-1.4735968926398411,-1.182577089806973,1.5727989104162301,1.0231492615366127,-0.45111440945460196,-0.99465521947049762,0.32960222906226222,1.3950601533529898,0.40772795256331712,-0.67683007639993475,0.55527266991720281,-0.013132776621837983,0.62065126373543911,-1.2275346022306346,1.9732862171756635,-0.23581058359927171,-0.1152332263935758,0.54844202435037137,0.32234975035258012,1.1516540946895086,-1.2865118252092693,-0.057654152939215719,-2.0721353969785654,0.48809281185725095,-0.30683264900775842,1.5087139518276891,2.5290828090017663,-0.096974776693622977,1.2771504607455868,-0.30571754140210516,1.8315259231620162,1.9990530568520009,1.3179698072138151,-1.3819032176942299,-0.70360389973534621,0.2776347932257921,-0.091082404593532562,1.6578180815137469,2.1141546880005402,1.0481269761359817,1.5009154117381895,0.39042401742672944,0.029712485649257547,1.18179397988041,0.022876597401807697,0.094408682115766029,-2.1651696896853361,-0.72788444138635433,-0.3762891358925165,1.068033554675504,1.577094644628914,-0.5200307500728556,-2.3837918251106962,-0.62642110177652011,0.47995058954609265,2.41096672507389,-0.12220155390943607,0.15145428174740005,-0.19246466285965824,-0.52390787343978551,-0.49677360928551029,-0.51746928125458491,1.8416083855188408,1.1794619759026661,-1.4242308709351092,-1.2970925417994885,0.19775939363886241,1.5191402899725059,-1.3774936488375882,-1.5563584571392286,-2.0890747129986118,-1.7944181436173368,-1.3610100960461102,-1.4471118122531705,2.746136982620528,2.3761382409740914,-0.30389616769251881,-1.0717329366704254,-0.47672987819551071,-0.24143364078997426,3.1248153077471441,-0.16283089530106198,0.6484344271145992,-0.73256173327365004,0.977310408647179,1.3377462550761052,0.60297583642416219,0.14103766630696055,-0.23939425601376152,-1.0027506478742241,-0.19669928141459603,1.8591066197598878,-1.0302856831363858,-1.2258105874640044,-2.2191677614609184,-0.44899866138179512,1.9030321585368926,-0.73057629158195225,1.1677943697899946,-0.0080630757180480406,0.72527455930859674,-0.73803448390727633,2.5031461475018286,-0.080655417313573396,0.22063940418352043,-0.4552807700784276,-2.4580842978466668,-1.9837540289694084,-0.60731967209121951,2.2899254798488498,1.3100161469910776,0.31810870285505044,-1.7104950099021698,1.1130278660446429,1.2800051230423526,1.3503035140975743,-0.29989292036763737,-1.9011153730718828,-2.1239939931945271,-3.1012550875706317,-2.5731769666669861,-0.52155804078897428,0.48556898184504627,0.061819777273359078,-1.1966849303900458,-1.2611119221098455,0.98412737342435264,2.0261526653608914,1.7068245682028886,1.019023791944802,-0.69593260574093296,-0.97296683010416896,2.2108744583230417,0.44552444434700711,1.3454281640740848,2.5034770695270057,1.4078243736223199,-1.324950455826543,3.372119522624704,3.9141698989307154,1.2223026872078269,0.72185523838297083,-0.039523581381668754,2.8161716292506362,1.2646470115771324,0.60923290043755329,2.2058929367852325,-0.6019487194683103,-0.05495278738912357,1.8153041250907731,3.3259030047506446,2.3182621946589919,1.4226297969717461,1.2611139608027857,-0.58029101229148738,-0.2156963836527962,0.5895001856036759,2.8375004084901723,3.0626028011672575,0.227203221335539,0.85579519124993098,2.8907779242971552,1.5230879974492704,0.90467166322867743,0.42366873774835256,1.8967830001268717,-0.5927374642490183,-1.8986472688245017,-1.1110521355092906,0.059636701745013343,2.3602748217564988,2.3643705088577653,1.8132975091504839,-0.34178574006204765,0.24522973584035468,0.89119961162799988,1.072454025796493,2.1506534422466062,-3.3881893294542826,-1.3882635911386083,0.93235520241435421,-0.15123300102783188,1.7985453249359387,-0.012915001715937957,0.12658795495914632],"text":"","type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[12784,12815,12843,12874,12904,12935,12965,12996,13027,13057,13088,13118,13149,13180,13208,13239,13269,13300,13330,13361,13392,13422,13453,13483,13514,13545,13573,13604,13634,13665,13695,13726,13757,13787,13818,13848,13879,13910,13939,13970,14000,14031,14061,14092,14123,14153,14184,14214,14245,14276,14304,14335,14365,14396,14426,14457,14488,14518,14549,14579,14610,14641,14669,14700,14730,14761,14791,14822,14853,14883,14914,14944,14975,15006,15034,15065,15095,15126,15156,15187,15218,15248,15279,15309,15340,15371,15400,15431,15461,15492,15522,15553,15584,15614,15645,15675,15706,15737,15765,15796,15826,15857,15887,15918,15949,15979,16010,16040,16071,16102,16130,16161,16191,16222,16252,16283,16314,16344,16375,16405,16436,16467,16495,16526,16556,16587,16617,16648,16679,16709,16740,16770,16801,16832,16861,16892,16922,16953,16983,17014,17045,17075,17106,17136,17167,17198,17226,17257,17287,17318,17348,17379,17410,17440,17471,17501,17532,17563,17591,17622,17652,17683,17713,17744,17775,17805,17836,17866,17897,17928,17956,17987,18017,18048,18078,18109,18140,18170,18201,18231,18262,18293,18322,18353,18383,18414,18444,18475,18506,18536,18567,18597,18628,18659,18687,18718,18748,18779,18809,18840,18871,18901,18932,18962,18993,19024,19052,19083,19113,19144,19174,19205,19236,19266,19297,19327,19358,19389,19417,19448,19478,19509,19539,19570,19601,19631,19662,19692,19723,19754,19783,19814,19844,19875,19905,19936,19967,19997,20028,20058,20089],"y":[-1.8951734852048394,0.84167689165559834,0.012224008098501438,0.10535538167803882,0.28817211306559587,-1.8795309155112627,-0.90985291321713069,-2.2979343741845542,-0.48925721648594189,-0.16875617778068086,-1.781150881297032,-0.88185310603501632,-1.6287555148834958,-1.4719290235409785,0.58399979341342689,0.23429118121511316,-1.2874671437750247,-2.2280230029789556,-2.2814540453113108,-1.3407797778910129,-2.0211155293446064,-1.5519735255951794,-0.0040503910196685311,-0.64583703557847594,-2.1968404987490744,-0.72186409162024434,-0.38047496220721455,0.69225321347070634,-0.5361180754349163,-1.0196157228478362,-2.8269644605880293,-1.5224182742281727,-1.8164598697820928,-0.63085843900168981,-1.1907602737686784,-1.5185641487625936,-1.7684974062857526,-1.5171601178062821,-1.8168268690728182,-0.69047480024834673,-1.662811411191381,-1.6324126657062492,-3.0778017432931555,-1.7255601115273116,-0.64672613087772046,-1.4603696683213729,-0.79038363684532575,-2.2037461505045788,-1.9596833883328857,0.16961420316297154,1.3169380717862893,1.5413309497198082,0.26782710409282329,-2.1927398379217133,-1.3094036638328335,-1.4090678276390749,-1.4735968926398411,-1.182577089806973,1.5727989104162301,1.0231492615366127,-0.45111440945460196,-0.99465521947049762,0.32960222906226222,1.3950601533529898,0.40772795256331712,-0.67683007639993475,0.55527266991720281,-0.013132776621837983,0.62065126373543911,-1.2275346022306346,1.9732862171756635,-0.23581058359927171,-0.1152332263935758,0.54844202435037137,0.32234975035258012,1.1516540946895086,-1.2865118252092693,-0.057654152939215719,-2.0721353969785654,0.48809281185725095,-0.30683264900775842,1.5087139518276891,2.5290828090017663,-0.096974776693622977,1.2771504607455868,-0.30571754140210516,1.8315259231620162,1.9990530568520009,1.3179698072138151,-1.3819032176942299,-0.70360389973534621,0.2776347932257921,-0.091082404593532562,1.6578180815137469,2.1141546880005402,1.0481269761359817,1.5009154117381895,0.39042401742672944,0.029712485649257547,1.18179397988041,0.022876597401807697,0.094408682115766029,-2.1651696896853361,-0.72788444138635433,-0.3762891358925165,1.068033554675504,1.577094644628914,-0.5200307500728556,-2.3837918251106962,-0.62642110177652011,0.47995058954609265,2.41096672507389,-0.12220155390943607,0.15145428174740005,-0.19246466285965824,-0.52390787343978551,-0.49677360928551029,-0.51746928125458491,1.8416083855188408,1.1794619759026661,-1.4242308709351092,-1.2970925417994885,0.19775939363886241,1.5191402899725059,-1.3774936488375882,-1.5563584571392286,-2.0890747129986118,-1.7944181436173368,-1.3610100960461102,-1.4471118122531705,2.746136982620528,2.3761382409740914,-0.30389616769251881,-1.0717329366704254,-0.47672987819551071,-0.24143364078997426,3.1248153077471441,-0.16283089530106198,0.6484344271145992,-0.73256173327365004,0.977310408647179,1.3377462550761052,0.60297583642416219,0.14103766630696055,-0.23939425601376152,-1.0027506478742241,-0.19669928141459603,1.8591066197598878,-1.0302856831363858,-1.2258105874640044,-2.2191677614609184,-0.44899866138179512,1.9030321585368926,-0.73057629158195225,1.1677943697899946,-0.0080630757180480406,0.72527455930859674,-0.73803448390727633,2.5031461475018286,-0.080655417313573396,0.22063940418352043,-0.4552807700784276,-2.4580842978466668,-1.9837540289694084,-0.60731967209121951,2.2899254798488498,1.3100161469910776,0.31810870285505044,-1.7104950099021698,1.1130278660446429,1.2800051230423526,1.3503035140975743,-0.29989292036763737,-1.9011153730718828,-2.1239939931945271,-3.1012550875706317,-2.5731769666669861,-0.52155804078897428,0.48556898184504627,0.061819777273359078,-1.1966849303900458,-1.2611119221098455,0.98412737342435264,2.0261526653608914,1.7068245682028886,1.019023791944802,-0.69593260574093296,-0.97296683010416896,2.2108744583230417,0.44552444434700711,1.3454281640740848,2.5034770695270057,1.4078243736223199,-1.324950455826543,3.372119522624704,3.9141698989307154,1.2223026872078269,0.72185523838297083,-0.039523581381668754,2.8161716292506362,1.2646470115771324,0.60923290043755329,2.2058929367852325,-0.6019487194683103,-0.05495278738912357,1.8153041250907731,3.3259030047506446,2.3182621946589919,1.4226297969717461,1.2611139608027857,-0.58029101229148738,-0.2156963836527962,0.5895001856036759,2.8375004084901723,3.0626028011672575,0.227203221335539,0.85579519124993098,2.8907779242971552,1.5230879974492704,0.90467166322867743,0.42366873774835256,1.8967830001268717,-0.5927374642490183,-1.8986472688245017,-1.1110521355092906,0.059636701745013343,2.3602748217564988,2.3643705088577653,1.8132975091504839,-0.34178574006204765,0.24522973584035468,0.89119961162799988,1.072454025796493,2.1506534422466062,-3.3881893294542826,-1.3882635911386083,0.93235520241435421,-0.15123300102783188,1.7985453249359387,-0.012915001715937957,0.12658795495914632],"text":["Month: 1 2005 <br>Extreme Index: -1.9","Month: 2 2005 <br>Extreme Index: 0.84","Month: 3 2005 <br>Extreme Index: 0.01","Month: 4 2005 <br>Extreme Index: 0.11","Month: 5 2005 <br>Extreme Index: 0.29","Month: 6 2005 <br>Extreme Index: -1.88","Month: 7 2005 <br>Extreme Index: -0.91","Month: 8 2005 <br>Extreme Index: -2.3","Month: 9 2005 <br>Extreme Index: -0.49","Month: 10 2005 <br>Extreme Index: -0.17","Month: 11 2005 <br>Extreme Index: -1.78","Month: 12 2005 <br>Extreme Index: -0.88","Month: 1 2006 <br>Extreme Index: -1.63","Month: 2 2006 <br>Extreme Index: -1.47","Month: 3 2006 <br>Extreme Index: 0.58","Month: 4 2006 <br>Extreme Index: 0.23","Month: 5 2006 <br>Extreme Index: -1.29","Month: 6 2006 <br>Extreme Index: -2.23","Month: 7 2006 <br>Extreme Index: -2.28","Month: 8 2006 <br>Extreme Index: -1.34","Month: 9 2006 <br>Extreme Index: -2.02","Month: 10 2006 <br>Extreme Index: -1.55","Month: 11 2006 <br>Extreme Index: 0","Month: 12 2006 <br>Extreme Index: -0.65","Month: 1 2007 <br>Extreme Index: -2.2","Month: 2 2007 <br>Extreme Index: -0.72","Month: 3 2007 <br>Extreme Index: -0.38","Month: 4 2007 <br>Extreme Index: 0.69","Month: 5 2007 <br>Extreme Index: -0.54","Month: 6 2007 <br>Extreme Index: -1.02","Month: 7 2007 <br>Extreme Index: -2.83","Month: 8 2007 <br>Extreme Index: -1.52","Month: 9 2007 <br>Extreme Index: -1.82","Month: 10 2007 <br>Extreme Index: -0.63","Month: 11 2007 <br>Extreme Index: -1.19","Month: 12 2007 <br>Extreme Index: -1.52","Month: 1 2008 <br>Extreme Index: -1.77","Month: 2 2008 <br>Extreme Index: -1.52","Month: 3 2008 <br>Extreme Index: -1.82","Month: 4 2008 <br>Extreme Index: -0.69","Month: 5 2008 <br>Extreme Index: -1.66","Month: 6 2008 <br>Extreme Index: -1.63","Month: 7 2008 <br>Extreme Index: -3.08","Month: 8 2008 <br>Extreme Index: -1.73","Month: 9 2008 <br>Extreme Index: -0.65","Month: 10 2008 <br>Extreme Index: -1.46","Month: 11 2008 <br>Extreme Index: -0.79","Month: 12 2008 <br>Extreme Index: -2.2","Month: 1 2009 <br>Extreme Index: -1.96","Month: 2 2009 <br>Extreme Index: 0.17","Month: 3 2009 <br>Extreme Index: 1.32","Month: 4 2009 <br>Extreme Index: 1.54","Month: 5 2009 <br>Extreme Index: 0.27","Month: 6 2009 <br>Extreme Index: -2.19","Month: 7 2009 <br>Extreme Index: -1.31","Month: 8 2009 <br>Extreme Index: -1.41","Month: 9 2009 <br>Extreme Index: -1.47","Month: 10 2009 <br>Extreme Index: -1.18","Month: 11 2009 <br>Extreme Index: 1.57","Month: 12 2009 <br>Extreme Index: 1.02","Month: 1 2010 <br>Extreme Index: -0.45","Month: 2 2010 <br>Extreme Index: -0.99","Month: 3 2010 <br>Extreme Index: 0.33","Month: 4 2010 <br>Extreme Index: 1.4","Month: 5 2010 <br>Extreme Index: 0.41","Month: 6 2010 <br>Extreme Index: -0.68","Month: 7 2010 <br>Extreme Index: 0.56","Month: 8 2010 <br>Extreme Index: -0.01","Month: 9 2010 <br>Extreme Index: 0.62","Month: 10 2010 <br>Extreme Index: -1.23","Month: 11 2010 <br>Extreme Index: 1.97","Month: 12 2010 <br>Extreme Index: -0.24","Month: 1 2011 <br>Extreme Index: -0.12","Month: 2 2011 <br>Extreme Index: 0.55","Month: 3 2011 <br>Extreme Index: 0.32","Month: 4 2011 <br>Extreme Index: 1.15","Month: 5 2011 <br>Extreme Index: -1.29","Month: 6 2011 <br>Extreme Index: -0.06","Month: 7 2011 <br>Extreme Index: -2.07","Month: 8 2011 <br>Extreme Index: 0.49","Month: 9 2011 <br>Extreme Index: -0.31","Month: 10 2011 <br>Extreme Index: 1.51","Month: 11 2011 <br>Extreme Index: 2.53","Month: 12 2011 <br>Extreme Index: -0.1","Month: 1 2012 <br>Extreme Index: 1.28","Month: 2 2012 <br>Extreme Index: -0.31","Month: 3 2012 <br>Extreme Index: 1.83","Month: 4 2012 <br>Extreme Index: 2","Month: 5 2012 <br>Extreme Index: 1.32","Month: 6 2012 <br>Extreme Index: -1.38","Month: 7 2012 <br>Extreme Index: -0.7","Month: 8 2012 <br>Extreme Index: 0.28","Month: 9 2012 <br>Extreme Index: -0.09","Month: 10 2012 <br>Extreme Index: 1.66","Month: 11 2012 <br>Extreme Index: 2.11","Month: 12 2012 <br>Extreme Index: 1.05","Month: 1 2013 <br>Extreme Index: 1.5","Month: 2 2013 <br>Extreme Index: 0.39","Month: 3 2013 <br>Extreme Index: 0.03","Month: 4 2013 <br>Extreme Index: 1.18","Month: 5 2013 <br>Extreme Index: 0.02","Month: 6 2013 <br>Extreme Index: 0.09","Month: 7 2013 <br>Extreme Index: -2.17","Month: 8 2013 <br>Extreme Index: -0.73","Month: 9 2013 <br>Extreme Index: -0.38","Month: 10 2013 <br>Extreme Index: 1.07","Month: 11 2013 <br>Extreme Index: 1.58","Month: 12 2013 <br>Extreme Index: -0.52","Month: 1 2014 <br>Extreme Index: -2.38","Month: 2 2014 <br>Extreme Index: -0.63","Month: 3 2014 <br>Extreme Index: 0.48","Month: 4 2014 <br>Extreme Index: 2.41","Month: 5 2014 <br>Extreme Index: -0.12","Month: 6 2014 <br>Extreme Index: 0.15","Month: 7 2014 <br>Extreme Index: -0.19","Month: 8 2014 <br>Extreme Index: -0.52","Month: 9 2014 <br>Extreme Index: -0.5","Month: 10 2014 <br>Extreme Index: -0.52","Month: 11 2014 <br>Extreme Index: 1.84","Month: 12 2014 <br>Extreme Index: 1.18","Month: 1 2015 <br>Extreme Index: -1.42","Month: 2 2015 <br>Extreme Index: -1.3","Month: 3 2015 <br>Extreme Index: 0.2","Month: 4 2015 <br>Extreme Index: 1.52","Month: 5 2015 <br>Extreme Index: -1.38","Month: 6 2015 <br>Extreme Index: -1.56","Month: 7 2015 <br>Extreme Index: -2.09","Month: 8 2015 <br>Extreme Index: -1.79","Month: 9 2015 <br>Extreme Index: -1.36","Month: 10 2015 <br>Extreme Index: -1.45","Month: 11 2015 <br>Extreme Index: 2.75","Month: 12 2015 <br>Extreme Index: 2.38","Month: 1 2016 <br>Extreme Index: -0.3","Month: 2 2016 <br>Extreme Index: -1.07","Month: 3 2016 <br>Extreme Index: -0.48","Month: 4 2016 <br>Extreme Index: -0.24","Month: 5 2016 <br>Extreme Index: 3.12","Month: 6 2016 <br>Extreme Index: -0.16","Month: 7 2016 <br>Extreme Index: 0.65","Month: 8 2016 <br>Extreme Index: -0.73","Month: 9 2016 <br>Extreme Index: 0.98","Month: 10 2016 <br>Extreme Index: 1.34","Month: 11 2016 <br>Extreme Index: 0.6","Month: 12 2016 <br>Extreme Index: 0.14","Month: 1 2017 <br>Extreme Index: -0.24","Month: 2 2017 <br>Extreme Index: -1","Month: 3 2017 <br>Extreme Index: -0.2","Month: 4 2017 <br>Extreme Index: 1.86","Month: 5 2017 <br>Extreme Index: -1.03","Month: 6 2017 <br>Extreme Index: -1.23","Month: 7 2017 <br>Extreme Index: -2.22","Month: 8 2017 <br>Extreme Index: -0.45","Month: 9 2017 <br>Extreme Index: 1.9","Month: 10 2017 <br>Extreme Index: -0.73","Month: 11 2017 <br>Extreme Index: 1.17","Month: 12 2017 <br>Extreme Index: -0.01","Month: 1 2018 <br>Extreme Index: 0.73","Month: 2 2018 <br>Extreme Index: -0.74","Month: 3 2018 <br>Extreme Index: 2.5","Month: 4 2018 <br>Extreme Index: -0.08","Month: 5 2018 <br>Extreme Index: 0.22","Month: 6 2018 <br>Extreme Index: -0.46","Month: 7 2018 <br>Extreme Index: -2.46","Month: 8 2018 <br>Extreme Index: -1.98","Month: 9 2018 <br>Extreme Index: -0.61","Month: 10 2018 <br>Extreme Index: 2.29","Month: 11 2018 <br>Extreme Index: 1.31","Month: 12 2018 <br>Extreme Index: 0.32","Month: 1 2019 <br>Extreme Index: -1.71","Month: 2 2019 <br>Extreme Index: 1.11","Month: 3 2019 <br>Extreme Index: 1.28","Month: 4 2019 <br>Extreme Index: 1.35","Month: 5 2019 <br>Extreme Index: -0.3","Month: 6 2019 <br>Extreme Index: -1.9","Month: 7 2019 <br>Extreme Index: -2.12","Month: 8 2019 <br>Extreme Index: -3.1","Month: 9 2019 <br>Extreme Index: -2.57","Month: 10 2019 <br>Extreme Index: -0.52","Month: 11 2019 <br>Extreme Index: 0.49","Month: 12 2019 <br>Extreme Index: 0.06","Month: 1 2020 <br>Extreme Index: -1.2","Month: 2 2020 <br>Extreme Index: -1.26","Month: 3 2020 <br>Extreme Index: 0.98","Month: 4 2020 <br>Extreme Index: 2.03","Month: 5 2020 <br>Extreme Index: 1.71","Month: 6 2020 <br>Extreme Index: 1.02","Month: 7 2020 <br>Extreme Index: -0.7","Month: 8 2020 <br>Extreme Index: -0.97","Month: 9 2020 <br>Extreme Index: 2.21","Month: 10 2020 <br>Extreme Index: 0.45","Month: 11 2020 <br>Extreme Index: 1.35","Month: 12 2020 <br>Extreme Index: 2.5","Month: 1 2021 <br>Extreme Index: 1.41","Month: 2 2021 <br>Extreme Index: -1.32","Month: 3 2021 <br>Extreme Index: 3.37","Month: 4 2021 <br>Extreme Index: 3.91","Month: 5 2021 <br>Extreme Index: 1.22","Month: 6 2021 <br>Extreme Index: 0.72","Month: 7 2021 <br>Extreme Index: -0.04","Month: 8 2021 <br>Extreme Index: 2.82","Month: 9 2021 <br>Extreme Index: 1.26","Month: 10 2021 <br>Extreme Index: 0.61","Month: 11 2021 <br>Extreme Index: 2.21","Month: 12 2021 <br>Extreme Index: -0.6","Month: 1 2022 <br>Extreme Index: -0.05","Month: 2 2022 <br>Extreme Index: 1.82","Month: 3 2022 <br>Extreme Index: 3.33","Month: 4 2022 <br>Extreme Index: 2.32","Month: 5 2022 <br>Extreme Index: 1.42","Month: 6 2022 <br>Extreme Index: 1.26","Month: 7 2022 <br>Extreme Index: -0.58","Month: 8 2022 <br>Extreme Index: -0.22","Month: 9 2022 <br>Extreme Index: 0.59","Month: 10 2022 <br>Extreme Index: 2.84","Month: 11 2022 <br>Extreme Index: 3.06","Month: 12 2022 <br>Extreme Index: 0.23","Month: 1 2023 <br>Extreme Index: 0.86","Month: 2 2023 <br>Extreme Index: 2.89","Month: 3 2023 <br>Extreme Index: 1.52","Month: 4 2023 <br>Extreme Index: 0.9","Month: 5 2023 <br>Extreme Index: 0.42","Month: 6 2023 <br>Extreme Index: 1.9","Month: 7 2023 <br>Extreme Index: -0.59","Month: 8 2023 <br>Extreme Index: -1.9","Month: 9 2023 <br>Extreme Index: -1.11","Month: 10 2023 <br>Extreme Index: 0.06","Month: 11 2023 <br>Extreme Index: 2.36","Month: 12 2023 <br>Extreme Index: 2.36","Month: 1 2024 <br>Extreme Index: 1.81","Month: 2 2024 <br>Extreme Index: -0.34","Month: 3 2024 <br>Extreme Index: 0.25","Month: 4 2024 <br>Extreme Index: 0.89","Month: 5 2024 <br>Extreme Index: 1.07","Month: 6 2024 <br>Extreme Index: 2.15","Month: 7 2024 <br>Extreme Index: -3.39","Month: 8 2024 <br>Extreme Index: -1.39","Month: 9 2024 <br>Extreme Index: 0.93","Month: 10 2024 <br>Extreme Index: -0.15","Month: 11 2024 <br>Extreme Index: 1.8","Month: 12 2024 <br>Extreme Index: -0.01","Month: 1 2025 <br>Extreme Index: 0.13"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,0,0,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,0,0,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.762557077625573,"r":7.3059360730593621,"b":40.182648401826498,"l":37.260273972602747},"font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"title":{"text":"Extreme Weather Index Over Time","font":{"color":"rgba(0,0,0,1)","family":"","size":17.534246575342465},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[12418.75,20454.25],"tickmode":"array","ticktext":["2005","2010","2015","2020","2025"],"tickvals":[12784,14610,16436,18262,20089],"categoryorder":"array","categoryarray":["2005","2010","2015","2020","2025"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.6529680365296811,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Time (Month)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-3.7533072908735328,4.2792878603499656],"tickmode":"array","ticktext":["-2","0","2","4"],"tickvals":[-2,0,2,4],"categoryorder":"array","categoryarray":["-2","0","2","4"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.6529680365296811,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"Extreme Weather Index","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":null,"bordercolor":null,"borderwidth":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"7c991b0b32b5":{"x":{},"y":{},"type":"scatter"},"7c997c2e16f1":{"x":{},"y":{},"text":{}}},"cur_data":"7c991b0b32b5","visdat":{"7c991b0b32b5":["function (y) ","x"],"7c997c2e16f1":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="month-data-extraction" class="level3">
<h3 class="anchored" data-anchor-id="month-data-extraction">Month Data Extraction</h3>
<p>We found that April 2021 had the most extreme weather. Therefore, we will extract this month for deeper insights with geospatial analysis ( for the purpose of this take-home exercise).</p>
<p>We keep the stations that has data for all three fields throughout our time-series data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>weather_month <span class="ot">&lt;-</span> weather_filtered <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2021</span>, Month <span class="sc">==</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Station) <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">MonthlyRainfall =</span> <span class="fu">sum</span>(DailyRainfall, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">MonthlyMeanTemp =</span> <span class="fu">mean</span>(MeanTemperature, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">MonthlyMeanWindSpeed =</span> <span class="fu">mean</span>(MeanWindSpeed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>keepstations <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Admiralty"</span>, <span class="st">"Ang Mo Kio"</span>, <span class="st">"Changi"</span>,<span class="st">"Choa Chu Kang (South)"</span>,<span class="st">"East Coast Parkway"</span>,<span class="st">"Jurong (West)"</span>,<span class="st">"Jurong Island"</span>,<span class="st">"Newton"</span>,<span class="st">"Pasir Panjang"</span>,<span class="st">"Pulau Ubin"</span>,<span class="st">"Seletar"</span>,<span class="st">"Sentosa Island"</span>,<span class="st">"Tai Seng"</span>,<span class="st">"Tuas South"</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>weather_month<span class="ot">&lt;-</span> weather_month<span class="sc">%&gt;%</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Station <span class="sc">%in%</span> keepstations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We save it in the same way as a rds file.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Save</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Load</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(weather_month, <span class="st">"data/rds/weather_month.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>weather_month <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/weather_month.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<hr>
</section>
</section>
</section>
<section id="geospatial-data" class="level1">
<h1>Geospatial Data</h1>
<p>Import the geospatial data using <code>st_read</code> and then transform it to Singapore’s coordinate reference system (CRS) 3414 using the <code>st_transform</code> function from the <code>sf</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>mpsz2019 <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial"</span>, </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">layer =</span> <span class="st">"MPSZ-2019"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `MPSZ-2019' from data source 
  `/Users/seesarhlakyi/Desktop/ssrhk/VA Project/isss608_Jan25_Group7/Prototypes/data/geospatial' 
  using driver `ESRI Shapefile'
Simple feature collection with 332 features and 6 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 103.6057 ymin: 1.158699 xmax: 104.0885 ymax: 1.470775
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
<p>We save this for later use.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">Save</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Load</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(mpsz2019, <span class="st">"data/rds/mpsz2019.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>mpsz2019 <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/mpsz2019.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<hr>
</section>
<section id="spatial-interpolation" class="level1">
<h1>Spatial Interpolation</h1>
<p>Spatial interpolation is a critical technique in geospatial analysis, especially when dealing with unsampled locations. In the case of the SG ClimateViz project, there are many areas where weather stations are missing or sparse, making it impossible to directly obtain weather-related metrics such as monthly rainfall for certain regions. Spatial interpolation allows us to estimate these missing values by leveraging the known data points from nearby locations.</p>
<section id="data-preparation" class="level2">
<h2 class="anchored" data-anchor-id="data-preparation">Data Preparation</h2>
<p>We need create a grid data object by using <code>rast()</code> of terra package as shown in the cod chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(mpsz2019, </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">nrows =</span> <span class="dv">200</span>, </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ncols =</span> <span class="dv">500</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>grid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class       : SpatRaster 
dimensions  : 200, 500, 1  (nrow, ncol, nlyr)
resolution  : 107.4578, 172.5381  (x, y)
extent      : 2667.538, 56396.44, 15748.72, 50256.33  (xmin, xmax, ymin, ymax)
coord. ref. : SVY21 / Singapore TM (EPSG:3414) </code></pre>
</div>
</div>
<p>Next, a list called xy will be created by using <code>xyFromCell()</code> of terra package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>xy <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">xyFromCell</span>(grid, </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">1</span><span class="sc">:</span><span class="fu">ncell</span>(grid))</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(xy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            x        y
[1,] 2721.267 50170.07
[2,] 2828.725 50170.07
[3,] 2936.183 50170.07
[4,] 3043.640 50170.07
[5,] 3151.098 50170.07
[6,] 3258.556 50170.07</code></pre>
</div>
</div>
<p>We will create a data frame called <em>coop</em> with prediction/simulation locations by using the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>coop <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(<span class="fu">as.data.frame</span>(xy), </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>),</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">crs =</span> <span class="fu">st_crs</span>(mpsz2019))</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>coop <span class="ot">&lt;-</span> <span class="fu">st_filter</span>(coop, mpsz2019)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(coop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 0 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 25072.49 ymin: 50170.07 xmax: 25717.24 ymax: 50170.07
Projected CRS: SVY21 / Singapore TM
                   geometry
1 POINT (25072.49 50170.07)
2 POINT (25179.95 50170.07)
3 POINT (25287.41 50170.07)
4 POINT (25502.32 50170.07)
5 POINT (25609.78 50170.07)
6 POINT (25717.24 50170.07)</code></pre>
</div>
</div>
</section>
<section id="manual-variogram" class="level2">
<h2 class="anchored" data-anchor-id="manual-variogram">Manual Variogram</h2>
<p>Kriging is one of several methods that use a limited set of sampled data points to estimate the value of a variable over a continuous spatial field. Since monthly rainfall over Singapore varies across a random spatial field, we will use kriging.</p>
<p>Let’s explore both manually inputting variogram paramaters and autofitting it. The following steps and code chunk was used to perform kriging.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The empirical variogram</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>v_temp <span class="ot">&lt;-</span> <span class="fu">variogram</span>(MonthlyMeanTemp <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> weather_month)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Manually fit the variogram model</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>fv_temp <span class="ot">&lt;-</span> <span class="fu">fit.variogram</span>(v_temp, <span class="at">model =</span> <span class="fu">vgm</span>(<span class="at">psill =</span> <span class="fl">0.5</span>, <span class="at">model =</span> <span class="st">"Sph"</span>, <span class="at">range =</span> <span class="dv">5000</span>, <span class="at">nugget =</span> <span class="fl">0.1</span>))</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform Kriging</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>k_temp <span class="ot">&lt;-</span> <span class="fu">gstat</span>(<span class="at">formula =</span> MonthlyMeanTemp <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> weather_month, <span class="at">model =</span> fv_temp)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create prediction grid and perform kriging</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>resp_temp <span class="ot">&lt;-</span> <span class="fu">predict</span>(k_temp, coop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[using ordinary kriging]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract coordinates and predictions</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>resp_temp<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(resp_temp)[,<span class="dv">1</span>]</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>resp_temp<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(resp_temp)[,<span class="dv">2</span>]</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>resp_temp<span class="sc">$</span>pred <span class="ot">&lt;-</span> resp_temp<span class="sc">$</span>var1.pred</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Kriging Variance</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>resp_temp<span class="sc">$</span>variance <span class="ot">&lt;-</span> resp_temp<span class="sc">$</span>var1.var</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create raster layer for predicted values</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>kpred_temp <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rasterize</span>(resp_temp, grid, <span class="at">field =</span> <span class="st">"pred"</span>)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create raster layer for Kriging Variance</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>kpred_temp_variance <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rasterize</span>(resp_temp, grid, <span class="at">field =</span> <span class="st">"variance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">Mean Temp</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">Kriging Variance</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(kpred_temp) <span class="sc">+</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">col_alpha =</span> <span class="fl">0.6</span>, </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.scale =</span> <span class="fu">tm_scale</span>(<span class="at">values =</span> <span class="st">"brewer.yl_or_rd"</span>), </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.legend =</span> <span class="fu">tm_legend</span>(<span class="at">title =</span> <span class="st">"Mean Temperature (°C)"</span>)) <span class="sc">+</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_title</span>(<span class="st">"Distribution of Mean Temperature, Apr 2021"</span>) <span class="sc">+</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"8star"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Geo_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(kpred_temp_variance) <span class="sc">+</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">col_alpha =</span> <span class="fl">0.6</span>, </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.scale =</span> <span class="fu">tm_scale</span>(<span class="at">values =</span> <span class="st">"brewer.yl_gn_bu"</span>), </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.legend =</span> <span class="fu">tm_legend</span>(<span class="at">title =</span> <span class="st">"Temperature Variance"</span>)) <span class="sc">+</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_title</span>(<span class="st">"Kriging Variance of Temperature, Apr 2021"</span>) <span class="sc">+</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"8star"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Geo_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="autovariogram" class="level2">
<h2 class="anchored" data-anchor-id="autovariogram">AutoVariogram</h2>
<p>Next, we explore autofitting by using <em>autofitVariogram</em>. The rest of the steps are the same as the previous section.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Kriging for Monthly Mean Temperature</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>v_temp <span class="ot">&lt;-</span> <span class="fu">autofitVariogram</span>(MonthlyMeanTemp <span class="sc">~</span> <span class="dv">1</span>, weather_month)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>k_temp <span class="ot">&lt;-</span> <span class="fu">gstat</span>(<span class="at">formula =</span> MonthlyMeanTemp <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">model =</span> v_temp<span class="sc">$</span>var_model,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> weather_month)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create prediction grid</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>resp_temp <span class="ot">&lt;-</span> <span class="fu">predict</span>(k_temp, coop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[using ordinary kriging]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract coordinates </span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>resp_temp<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(resp_temp)[,<span class="dv">1</span>]</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>resp_temp<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(resp_temp)[,<span class="dv">2</span>]</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>resp_temp<span class="sc">$</span>pred <span class="ot">&lt;-</span> resp_temp<span class="sc">$</span>var1.pred</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Kriging Variance</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>resp_temp<span class="sc">$</span>variance <span class="ot">&lt;-</span> resp_temp<span class="sc">$</span>var1.var</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create raster layer</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>kpred_temp <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rasterize</span>(resp_temp, grid, <span class="at">field =</span> <span class="st">"pred"</span>)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Kriging Variance Raster</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>kpred_temp_variance <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rasterize</span>(resp_temp, grid, <span class="at">field =</span> <span class="st">"variance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">Mean Temp</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">Kriging Variance</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(kpred_temp) <span class="sc">+</span> </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">col_alpha =</span> <span class="fl">0.6</span>, </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.scale =</span> <span class="fu">tm_scale</span>(<span class="at">values =</span> <span class="st">"brewer.yl_or_rd"</span>), </span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.legend =</span> <span class="fu">tm_legend</span>(<span class="at">title =</span> <span class="st">"Mean Temperature (°C)"</span>)) <span class="sc">+</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_title</span>(<span class="st">"Distribution of Mean Temperature, Apr 2021"</span>) <span class="sc">+</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"8star"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Geo_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(kpred_temp_variance) <span class="sc">+</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">col_alpha =</span> <span class="fl">0.6</span>, </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.scale =</span> <span class="fu">tm_scale</span>(<span class="at">values =</span> <span class="st">"brewer.yl_gn_bu"</span>), </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.legend =</span> <span class="fu">tm_legend</span>(<span class="at">title =</span> <span class="st">"Temperature Variance"</span>)) <span class="sc">+</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_title</span>(<span class="st">"Kriging Variance of Temperature, Apr 2021"</span>) <span class="sc">+</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"8star"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Geo_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" style="color: black; background-color: #e0f3f9">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Insights for Mean Temp
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>1. Spatial Interpolation of Mean Temperature</strong></p>
<p>Both maps of Mean Temperature Distribution appear visually identical, indicating that the temperature predictions are not significantly affected by variogram parameter adjustments. This suggests that the temperature trends are well captured by both approaches.</p>
<p><strong>2. Kriging Variance Comparison</strong></p>
<ul>
<li><p><strong>Auto Variogram:</strong></p>
<ul>
<li>The kriging variance is more evenly distributed, with slightly lower uncertainty in central regions.The pattern of variance seems more smooth, likely due to default parameters optimizing a general fit.</li>
</ul></li>
<li><p><strong>Manual Variogram Adjustments:</strong></p>
<ul>
<li><p>The variance map shows more pronounced patches of uncertainty in different locations.</p></li>
<li><p>The kriging variance is more localized, suggesting that the manual tuning has affected the spatial relationships between points.</p></li>
<li><p>This could indicate that the manually chosen sill, range, and model parameters have led to more refined spatial dependence assumptions.</p></li>
</ul></li>
</ul>
</div>
</div>
<hr>
</section>
</section>
<section id="prototype-1-spatial-interpolation" class="level1">
<h1>Prototype 1: Spatial Interpolation</h1>
<section id="shiny-ui" class="level2">
<h2 class="anchored" data-anchor-id="shiny-ui">Shiny UI</h2>
<p>The following is the sketch of planned Shiny App user interface<img src="proto1.png" class="img-fluid"></p>
</section>
<section id="shiny-app-prototype-1" class="level2">
<h2 class="anchored" data-anchor-id="shiny-app-prototype-1">Shiny App Prototype 1</h2>
<p>To ensure the components are compatible and ready for Shiny App development, I will be creating a mini Shiny App for the analysis above.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that this is a prototype and not the actual dimensions that will be shown in the Shiny app. The plots will be bigger. The actual dimensions may be viewed here:<a href="https://sshk.shinyapps.io/Take-Home3/" class="uri">https://sshk.shinyapps.io/Take-Home3/</a></p>
</div>
</div>
<iframe src="https://sshk.shinyapps.io/Take-Home3/" width="100%" height="600px">
</iframe>
<hr>
</section>
</section>
<section id="local-measure-of-spatial-autocorrelation" class="level1">
<h1>Local Measure of Spatial Autocorrelation</h1>
<p>The next steps involve calculating <strong>Local Moran’s I</strong> and visualizing the <strong>LISA (Local Indicators of Spatial Association)</strong> map. These methods will help us understand the spatial patterns of Mean Temperature, like clustering of high or low values.</p>
<section id="data-prep" class="level2">
<h2 class="anchored" data-anchor-id="data-prep">Data Prep</h2>
<p>Before doing our analysis, we must first filter for Jan 2021 to Apr 2024 (for Shiny App development) and just Apr 2021 (for this takehome exercise). We will do this on the dataframe that has not been converted to sf. For this section, we will only do this by left joining with the boundary polygons.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>weather <span class="ot">&lt;-</span> weather <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>((Year <span class="sc">&gt;</span> <span class="dv">2021</span> <span class="sc">|</span> (Year <span class="sc">==</span> <span class="dv">2021</span> <span class="sc">&amp;</span> Month <span class="sc">&gt;=</span> <span class="dv">1</span>)) <span class="sc">&amp;</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>         (Year <span class="sc">&lt;</span> <span class="dv">2024</span> <span class="sc">|</span> (Year <span class="sc">==</span> <span class="dv">2024</span> <span class="sc">&amp;</span> Month <span class="sc">&lt;=</span> <span class="dv">4</span>)))</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>weather_my <span class="ot">&lt;-</span> weather <span class="sc">%&gt;%</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2021</span>, Month <span class="sc">==</span> <span class="dv">4</span>)<span class="sc">%&gt;%</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>keepstations <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Admiralty"</span>, <span class="st">"Ang Mo Kio"</span>, <span class="st">"Changi"</span>,<span class="st">"Choa Chu Kang (South)"</span>,<span class="st">"East Coast Parkway"</span>,<span class="st">"Jurong (West)"</span>,<span class="st">"Jurong Island"</span>,<span class="st">"Newton"</span>,<span class="st">"Pasir Panjang"</span>,<span class="st">"Pulau Ubin"</span>,<span class="st">"Seletar"</span>,<span class="st">"Sentosa Island"</span>,<span class="st">"Tai Seng"</span>,<span class="st">"Tuas South"</span>)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>weather_my<span class="ot">&lt;-</span> weather_my<span class="sc">%&gt;%</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Station <span class="sc">%in%</span> keepstations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Import the boundary polygons using <em>st_read</em> and transform it to Singapore’s coordinate reference system (CRS) 3414 using the <em>st_transform.</em> Ensure that there is one common column, “Station”, and also ensure that the names of the Stations match that of weather_my dataframe that we just prepared.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial"</span>, </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">layer =</span> <span class="st">"MPSZ-2019"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Station =</span> PLN_AREA_N) <span class="sc">%&gt;%</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Station =</span> <span class="fu">ifelse</span>(Station <span class="sc">==</span> <span class="st">"SEMBAWANG"</span>, <span class="st">"Admiralty"</span>, Station)) <span class="sc">%&gt;%</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Station =</span> <span class="fu">ifelse</span>(Station <span class="sc">==</span> <span class="st">"ANG MO KIO"</span>, <span class="st">"Ang Mo Kio"</span>, Station)) <span class="sc">%&gt;%</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Station =</span> <span class="fu">ifelse</span>(Station <span class="sc">==</span> <span class="st">"CHANGI"</span>, <span class="st">"Changi"</span>, Station)) <span class="sc">%&gt;%</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Station =</span> <span class="fu">ifelse</span>(Station <span class="sc">==</span> <span class="st">"CHOA CHU KANG"</span>, <span class="st">"Choa Chu Kang (South)"</span>, Station))<span class="sc">%&gt;%</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Station =</span> <span class="fu">ifelse</span>(Station <span class="sc">==</span> <span class="st">"MARINE PARADE"</span>, <span class="st">"East Coast Parkway"</span>, Station))<span class="sc">%&gt;%</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Station =</span> <span class="fu">ifelse</span>(Station <span class="sc">==</span> <span class="st">"JURONG WEST"</span>, <span class="st">"Jurong (West)"</span>, Station))<span class="sc">%&gt;%</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Station =</span> <span class="fu">ifelse</span>(Station <span class="sc">==</span> <span class="st">"WESTERN ISLANDS"</span>, <span class="st">"Jurong Island"</span>, Station))<span class="sc">%&gt;%</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Station =</span> <span class="fu">ifelse</span>(Station <span class="sc">==</span> <span class="st">"NEWTON"</span>, <span class="st">"Newton"</span>, Station))<span class="sc">%&gt;%</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Station =</span> <span class="fu">ifelse</span>(Station <span class="sc">==</span> <span class="st">"QUEENSTOWN"</span>, <span class="st">"Pasir Panjang"</span>, Station))<span class="sc">%&gt;%</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Station =</span> <span class="fu">ifelse</span>(Station <span class="sc">==</span> <span class="st">"NORTH-EASTERN ISLANDS"</span>, <span class="st">"Pulau Ubin"</span>, Station))<span class="sc">%&gt;%</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Station =</span> <span class="fu">ifelse</span>(Station <span class="sc">==</span> <span class="st">"SELETAR"</span>, <span class="st">"Seletar"</span>, Station))<span class="sc">%&gt;%</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Station =</span> <span class="fu">ifelse</span>(Station <span class="sc">==</span> <span class="st">"SOUTHERN ISLANDS"</span>, <span class="st">"Sentosa Island"</span>, Station))<span class="sc">%&gt;%</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Station =</span> <span class="fu">ifelse</span>(Station <span class="sc">==</span> <span class="st">"HOUGANG"</span>, <span class="st">"Tai Seng"</span>, Station))<span class="sc">%&gt;%</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Station =</span> <span class="fu">ifelse</span>(Station <span class="sc">==</span> <span class="st">"TUAS"</span>, <span class="st">"Tuas South"</span>, Station))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `MPSZ-2019' from data source 
  `/Users/seesarhlakyi/Desktop/ssrhk/VA Project/isss608_Jan25_Group7/Prototypes/data/geospatial' 
  using driver `ESRI Shapefile'
Simple feature collection with 332 features and 6 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 103.6057 ymin: 1.158699 xmax: 104.0885 ymax: 1.470775
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
<p>Left join the boundary data into weather_my using the common column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>weather_with_zones <span class="ot">&lt;-</span> <span class="fu">left_join</span>(weather_my,mpsz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Aggregate columns by calculating MonthlyRainfall, MonthlyMeanTemp, and MonthlyMeanWindSpeed for each Station for April 2021. While aggregating, we also ensure that there is only one single polygon for each station using <em>st_union</em>. Lastly, we convert it as sf using <em>st_as_sf</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>weather_with_zones_single_polygon <span class="ot">&lt;-</span> weather_with_zones <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Station) <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">MonthlyRainfall =</span> <span class="fu">sum</span>(DailyRainfall, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">MonthlyMeanTemp =</span> <span class="fu">mean</span>(MeanTemperature, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">MonthlyMeanWindSpeed =</span> <span class="fu">mean</span>(MeanWindSpeed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">geometry =</span> <span class="fu">st_union</span>(geometry),</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>weather_with_zones_single_polygon <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(weather_with_zones_single_polygon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="raw-data---before-spatial-interpolation" class="level2">
<h2 class="anchored" data-anchor-id="raw-data---before-spatial-interpolation">Raw Data - Before Spatial Interpolation</h2>
<p>Let’s first explore local measures of the raw data before doing any spatial interpolation.</p>
<p>Recall that only 14 stations have recorded data available for all three variables of interest so there will be missing parts. Let’s visualize Local Moran I for the raw data with 14 stations present.</p>
<p>Step 1: Compute centroids from prepared data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>weather_centroids <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(weather_with_zones_single_polygon) </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>knn <span class="ot">&lt;-</span> <span class="fu">st_knn</span>(weather_centroids, <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>knn_weights <span class="ot">&lt;-</span> <span class="fu">st_weights</span>(knn, <span class="at">style =</span> <span class="st">"W"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Step 2: Calculate Local Moran’s I for the predicted values and merge the Local Moran’s I results back into the sf object</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>local_moran_res <span class="ot">&lt;-</span> <span class="fu">local_moran</span>(weather_centroids<span class="sc">$</span>MonthlyMeanTemp, </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>                              knn, </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>                               knn_weights, </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">nsim =</span> <span class="dv">99</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>local_moran_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(local_moran_res)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>weather_lisa <span class="ot">&lt;-</span> weather_with_zones_single_polygon <span class="sc">%&gt;%</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ii =</span> local_moran_df<span class="sc">$</span>ii, </span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">p_ii_sim =</span> local_moran_df<span class="sc">$</span>p_ii_sim,</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">p_ii =</span> local_moran_df<span class="sc">$</span>p_ii,</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">mean =</span> local_moran_df<span class="sc">$</span>mean,</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">.before =</span> <span class="dv">1</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Step 3: Plot the Local Moran’s I map and P-value significance map</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Local Moran’s I Map </span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(weather_lisa) <span class="sc">+</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"ii"</span>, </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill.scale =</span> <span class="fu">tm_scale</span>(<span class="at">palette =</span> <span class="st">"RdBu"</span>, <span class="at">midpoint =</span> <span class="dv">0</span>), </span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.show =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>() <span class="sc">+</span>  </span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_title</span>(<span class="st">"Local Moran's I of Kriged Mean Temperature"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span>  </span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_legend</span>(<span class="at">text.size =</span> <span class="fl">0.5</span>)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="co"># P-value significance map </span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(weather_lisa) <span class="sc">+</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"p_ii"</span>, </span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill.scale =</span> <span class="fu">tm_scale</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="dv">1</span>),</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>                               <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0.001"</span>, <span class="st">"0.01"</span>, <span class="st">"0.05"</span>, <span class="st">"Not sig"</span>)),</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>,  </span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">midpoint =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>() <span class="sc">+</span>  </span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_title</span>(<span class="st">"P-value of Local Moran's I"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span>  </span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_legend</span>(<span class="at">text.size =</span> <span class="fl">0.5</span>)</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(plot1, plot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Geo_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can see from the above plots that it is a broken map with only a few stations present. There is a need to perform spatial interpolation for areas with no recorded data.</p>
</section>
<section id="after-spatial-interpolation" class="level2">
<h2 class="anchored" data-anchor-id="after-spatial-interpolation">After Spatial Interpolation</h2>
<p>As we did before, we will perform spatial interpolation in the following steps:</p>
<p>Step 1: Convert weather station data to sf object by using st_as_sf</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>weather_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(weather_with_zones_single_polygon, <span class="at">crs =</span> <span class="fu">st_crs</span>(mpsz))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Step 2: Fit Exponential variogram model using variogram</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>variogram_model <span class="ot">&lt;-</span> <span class="fu">variogram</span>(MonthlyMeanTemp <span class="sc">~</span> <span class="dv">1</span>, weather_sf)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> <span class="fu">fit.variogram</span>(<span class="fu">variogram</span>(MonthlyMeanTemp <span class="sc">~</span> <span class="dv">1</span>, weather_sf), <span class="at">model =</span> <span class="fu">vgm</span>(<span class="st">"Exp"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Step 3: Apply Ordinary Kriging with the new model and convert kriging result to sf</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>kriging_result <span class="ot">&lt;-</span> <span class="fu">krige</span>(MonthlyMeanTemp <span class="sc">~</span> <span class="dv">1</span>, weather_sf, mpsz, <span class="at">model =</span> fit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[using ordinary kriging]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>kriged_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(kriging_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that the kriging output is in polygons.</p>
<p>Step 4: Create centroids for the polygons in mpsz2019. Use KNN (K-Nearest Neighbors, this is set as 3) on centroids to compute spatial weights and compute weights for KNN (using inverse distance as weights).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>mpsz_centroids <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(mpsz)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>knn_result <span class="ot">&lt;-</span> <span class="fu">st_knn</span>(mpsz_centroids, <span class="at">k =</span> <span class="dv">3</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>knn_weights <span class="ot">&lt;-</span> <span class="fu">st_weights</span>(knn_result, <span class="at">style =</span> <span class="st">"W"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Step 5: Calculate Local Moran’s I using KNN weights (with 99 simulations) and add Local Moran’s I results to the kriged polygons</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>local_moran_res <span class="ot">&lt;-</span> <span class="fu">local_moran</span>(kriged_sf<span class="sc">$</span>var1.pred, </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>                               knn_result, </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>                               knn_weights, </span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">nsim =</span> <span class="dv">99</span>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>local_moran_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(local_moran_res)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>kriged_sf <span class="ot">&lt;-</span> kriged_sf <span class="sc">%&gt;%</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">ii =</span> local_moran_df<span class="sc">$</span>ii,</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_ii_sim =</span> local_moran_df<span class="sc">$</span>p_ii_sim,</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_ii =</span> local_moran_df<span class="sc">$</span>p_ii,</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> local_moran_df<span class="sc">$</span>mean</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Step 6: Plot the Local Moran’s I map and P-value significance map using tmap.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Local Moran's I Map for mean temperature</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(kriged_sf) <span class="sc">+</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"ii"</span>, </span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill.scale =</span> <span class="fu">tm_scale</span>(<span class="at">midpoint =</span> <span class="dv">0</span>, <span class="at">palette =</span> <span class="st">"brewer.rd_bu"</span>), </span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.show =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>() <span class="sc">+</span>  </span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_title</span>(<span class="st">"Local Moran's I of Kriged Mean Temperature"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span>  </span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_legend</span>(<span class="at">text.size =</span> <span class="fl">0.5</span>)</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a><span class="co"># P-value significance map</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(kriged_sf) <span class="sc">+</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"p_ii"</span>, </span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill.scale =</span> <span class="fu">tm_scale</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="dv">1</span>),</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>                               <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0.001"</span>, <span class="st">"0.01"</span>, <span class="st">"0.05"</span>, <span class="st">"Not sig"</span>),</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>                               <span class="at">palette =</span> <span class="st">"brewer.blues"</span>),  </span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">midpoint =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>() <span class="sc">+</span>  </span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_title</span>(<span class="st">"P-value of Local Moran's I"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span>  </span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_legend</span>(<span class="at">text.size =</span> <span class="fl">0.5</span>)</span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(plot1, plot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Geo_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" style="color: black; background-color: #e0f3f9">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Insights from Local Moran I
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>1. Local Moran’s I:</strong> shows clusters and outliers of mean temperature based on spatial autocorrelation.</p>
<ul>
<li><p><strong>Darker green areas (higher Moran’s I values)</strong> indicate strong positive spatial autocorrelation, meaning these regions have neighboring areas with similar temperature values.</p></li>
<li><p><strong>Lighter green areas (lower Moran’s I values)</strong> suggest weaker spatial autocorrelation or more dispersed temperature patterns.</p></li>
<li><p><strong>Light purple areas (negative Moran’s I values)</strong> might indicate potential spatial outliers where temperature values differ significantly from their neighbors.</p></li>
<li><p>Strong positive clusters (dark green) are seen in the northwest and central regions of Singapore, meaning these areas have consistently high or low mean temperatures.</p></li>
<li><p>The southern and eastern regions appear to have weaker spatial autocorrelation, suggesting more temperature variability or transition zones between different temperature regimes.</p></li>
</ul>
<hr>
<p><strong>2. P-Value of Local Moran’s I:</strong> assesses the statistical significance of the Local Moran’s I results.</p>
<ul>
<li><p><strong>Purple areas (low p-values, &lt;0.2)</strong> indicate strong evidence that spatial clustering is significant (i.e., temperature patterns are not random).</p></li>
<li><p><strong>Green areas (higher p-values, &gt;0.6)</strong> suggest weaker or non-significant spatial autocorrelation, meaning that any apparent clustering might be due to chance.</p></li>
<li><p><strong>White areas (mid-range p-values, 0.4-0.6)</strong> indicate moderate evidence, suggesting inconclusive clustering.</p></li>
<li><p>The northern and central regions have significant clustering (dark purple), reinforcing that these areas show clear spatial dependence in temperature.</p></li>
<li><p>Some southwestern areas have higher p-values, meaning the detected clusters there might not be statistically significant.</p></li>
</ul>
</div>
</div>
<p>Step 7: Plot LISA Map for significant Local Moran’s I results (p-value &lt; 0.05) using tmap.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>lisa_sig <span class="ot">&lt;-</span> kriged_sf <span class="sc">%&gt;%</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(p_ii_sim <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="co"># LISA Map with polygon borders</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(kriged_sf) <span class="sc">+</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span>  </span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">fill_alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_title</span>(</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="st">"LISA Map"</span>,</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.5</span>  <span class="co"># Adjust title size</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(lisa_sig) <span class="sc">+</span>  </span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"mean"</span>, </span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill.scale =</span> <span class="fu">tm_scale</span>(<span class="at">palette =</span> <span class="st">"brewer.rd_bu"</span>, <span class="at">midpoint =</span> <span class="dv">0</span>),</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.show =</span> <span class="cn">TRUE</span>) <span class="sc">+</span>  </span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">fill_alpha =</span> <span class="fl">0.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Geo_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" style="color: black; background-color: #e0f3f9">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Insights from LISA map
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>1. High-High Clusters (Green Areas):</strong> These regions have high temperatures surrounded by high temperatures, indicating strong positive spatial autocorrelation.</p>
<ul>
<li><p><strong>Observed in:</strong></p>
<ul>
<li><p>Central Region (Bishan, Ang Mo Kio)</p></li>
<li><p>Southern coastal areas &amp; islands (Sentosa, Southern Islands, possibly Marina South)</p></li>
</ul></li>
<li><p><strong>Implications:</strong></p>
<ul>
<li><p>The central region is likely experiencing an urban heat island (UHI) effect due to dense urbanization.</p></li>
<li><p>Coastal/southern clusters may be influenced by heat-retaining surfaces and lower vegetation cover.</p></li>
</ul></li>
</ul>
<hr>
<p><strong>2. Low-Low Clusters (Red Areas):</strong> These areas have low temperatures surrounded by low temperatures, forming another significant cluster.</p>
<ul>
<li><p><strong>Observed in:</strong></p>
<ul>
<li>Northwestern Singapore (Lim Chu Kang, Kranji, parts of Woodlands and western regions)</li>
</ul></li>
<li><p><strong>Implications:</strong></p>
<ul>
<li><p>These areas tend to have more greenery, agricultural land, and water bodies, which contribute to cooling effects.</p></li>
<li><p>Less urban development may help moderate temperatures.</p></li>
</ul></li>
</ul>
<hr>
<p><strong>3. Non-Significant Areas (Gray):</strong> Most of the map is gray, meaning those regions do not show statistically significant clustering at the 0.05 level.</p>
<ul>
<li><p>Temperature patterns in these areas are more randomly distributed or do not have strong local spatial dependence for the month of April 2021.</p></li>
<li><p>The lack of strong clustering could be due to mixed land use, variable urbanization, or insufficient local temperature contrast.</p></li>
</ul>
<hr>
<p>Unlike some LISA maps, there are no High-Low (blue) or Low-High (yellow) clusters for the month of April in 2021.</p>
<ul>
<li>This suggests no strong spatial outliers (i.e., no hot spots surrounded by cold spots or vice versa).The temperature distribution is more continuous.</li>
</ul>
</div>
</div>
<hr>
</section>
</section>
<section id="prototype-2-local-measure-of-spatial-autocorrelation" class="level1">
<h1>Prototype 2: Local Measure of Spatial Autocorrelation</h1>
<section id="shiny-ui-1" class="level2">
<h2 class="anchored" data-anchor-id="shiny-ui-1">9.1 Shiny UI</h2>
<p>The following is the sketch of planned Shiny App user interface</p>
<p><img src="proto2.png" class="img-fluid"></p>
</section>
<section id="shiny-app-prototype-2" class="level2">
<h2 class="anchored" data-anchor-id="shiny-app-prototype-2">Shiny App Prototype 2</h2>
<p>To ensure the components are compatible and ready for Shiny App development, I will be creating a mini Shiny App for the analysis above.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that this is a prototype and not the actual dimensions that will be shown in the Shiny app. The plots will be bigger. The actual dimensions may be viewed here: <a href="https://sshk.shinyapps.io/proto2/" class="uri">https://sshk.shinyapps.io/proto2/</a></p>
</div>
</div>
<iframe src="https://sshk.shinyapps.io/proto2/" width="100%" height="600px">
</iframe>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>