<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sei Sar Hla Kyi, Sathvika Subramanian, Dew Stella Chan">
<meta name="dcterms.date" content="2025-03-09">

<title>Overview – WeatherWatch SG</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-6bd9cfa162949bde0a231f530c97869d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">WeatherWatch SG</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./Proposal.html" aria-current="page"> 
<span class="menu-text">Overview</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-shiny-app" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Shiny App</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-shiny-app">    
        <li>
    <a class="dropdown-item" href="./Shiny/Data_Prep.html">
 <span class="dropdown-text">Data Preparation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Shiny/Prototype.html">
 <span class="dropdown-text">Prototype</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./Team.html"> 
<span class="menu-text">The Team</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-meeting-minutes" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Meeting Minutes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-meeting-minutes">    
        <li>
    <a class="dropdown-item" href="./NOM/Meeting Minutes 01.html">
 <span class="dropdown-text">Meeting Minutes 01</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./NOM/Meeting Minutes 02.html">
 <span class="dropdown-text">Meeting Minutes 02</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./NOM/Meeting Minutes 03.html">
 <span class="dropdown-text">Meeting Minutes 03</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#motivation-background" id="toc-motivation-background" class="nav-link active" data-scroll-target="#motivation-background">1. Motivation &amp; Background</a></li>
  <li><a href="#objective" id="toc-objective" class="nav-link" data-scroll-target="#objective">2. Objective</a></li>
  <li><a href="#the-data-sets" id="toc-the-data-sets" class="nav-link" data-scroll-target="#the-data-sets">3. The Data sets</a></li>
  <li><a href="#methodology" id="toc-methodology" class="nav-link" data-scroll-target="#methodology">4. Methodology</a></li>
  <li><a href="#literature-review" id="toc-literature-review" class="nav-link" data-scroll-target="#literature-review">5. Literature Review</a></li>
  <li><a href="#prototype" id="toc-prototype" class="nav-link" data-scroll-target="#prototype">6. Prototype</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Overview</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Sei Sar Hla Kyi, Sathvika Subramanian, Dew Stella Chan </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 9, 2025</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">March 17, 2025</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="motivation-background" class="level2">
<h2 class="anchored" data-anchor-id="motivation-background">1. Motivation &amp; Background</h2>
<p>Climate change has become an increasingly urgent issue, with its effects becoming more noticeable worldwide. Singapore, as a tropical island nation, faces significant challenges due to climate change, including rising temperatures, increased humidity, more frequent extreme weather events, and rising sea levels. These environmental changes have far-reaching implications for public health, urban infrastructure, energy consumption, and economic resilience.</p>
<p>Over the past decades, Singapore has experienced a steady increase in temperature, with annual mean temperatures rising at twice the global average. This warming trend amplify urban heat island effects, increasing the risk of heat stress and related health concerns. Additionally, changes in precipitation patterns may lead to more intense rainfall events and prolonged dry spells, contributing to both flooding and water resource management issues. The rising temperatures also have economic consequences, as higher cooling demands strain the power grid, and extreme weather events disrupt transportation and daily activities.</p>
<p>Given the substantial impact of climate change on Singapore, it is crucial to analyse historical weather patterns to understand trends and potential future scenarios. By using meteorological data, we can gain deeper insights into how climate change is shaping Singapore’s environment and every day’s life. Our project seeks to visualize and analyse these climate trends, providing valuable insights into the evolving climate landscape of Singapore and its broader implications.</p>
</section>
<section id="objective" class="level2">
<h2 class="anchored" data-anchor-id="objective">2. Objective</h2>
<p>Our project aims to address several critical problems related to climate change in Singapore. One of the key objectives is to understand long-term climate trends by visualizing historical weather data, which will allow us to identify patterns such as rising temperatures, increased humidity, and extreme weather events.</p>
<p>Another important aspect of this study is examining the health impacts of climate change. By correlating weather data with records from the National Environment Agency (NEA), we aim to study the increase in the spread of vector-borne diseases like dengue. Dengue is one of the major climate-related health issues in Singapore, as warmer temperatures and increased rainfall create ideal breeding conditions for mosquitoes, leading to a surge in dengue cases. Understanding this links can help public health authorities implement better preventive measures and policies to mitigate health risks associated with climate change.</p>
<p>In addition to health concerns, climate change also has significant implications for energy consumption. As temperatures rise, the demand for electricity, particularly for cooling purposes, is expected to increase. Investigating these patterns will help us assess the impact of climate change on Singapore’s energy needs and inform sustainable energy policies that balance efficiency and environmental responsibility.</p>
<p>Furthermore, extreme weather events can disrupt transportation networks and affect commuting behaviors. Our project will explore the impact of weather conditions on taxi and hitch-hiring demand. By analysing these trends, we aim to provide insights that can support transportation planning and improve urban mobility resilience in the face of climate change.</p>
<p>Overall, our project seeks to provide actionable insights that can guide policymakers, urban planners, and public health officials in developing effective climate adaptation and mitigation strategies. By presenting our findings through visual analytics, we aim to enhance awareness of climate challenges and contribute to Singapore’s efforts in building a more climate-resilient future.</p>
</section>
<section id="the-data-sets" class="level2">
<h2 class="anchored" data-anchor-id="the-data-sets">3. The Data sets</h2>
<p>To analyse the impact of climate change on various aspects of daily life in Singapore, we will integrate multiple data sets from different government agencies. Our primary data set will be historical weather data from the Meteorological Service Singapore, which will provide information on temperature trends, rainfall patterns, humidity levels, and extreme weather events over the years. This data will serve as the foundation for identifying climate-related changes and their potential consequences.</p>
<p>In addition to weather data, we will incorporate a few other data sets with the following purposes:</p>
<p>1. Electricity consumption statistics from the Energy Market Authority (EMA): This data set will allow us to examine the correlation between rising temperatures and increased electricity demand.</p>
<p>2.Dengue case data from the National Environment Agency (NEA): By correlating dengue incidence rates with weather patterns, we aim to identify trends and evaluate the public health implications of climate change.</p>
<p>3. Private hire vehicle data from the Land Transport Authority (LTA): We will investigate how extreme weather events influence commuting behaviors and transport demand. Analysing fluctuations in taxi and ride-hailing demand during different weather conditions will provide insights into urban mobility patterns as well.</p>
<p>By combining these data sets, our project will provide a comprehensive analysis of how climate change affects various aspects of everyday life in Singapore.</p>
</section>
<section id="methodology" class="level2">
<h2 class="anchored" data-anchor-id="methodology">4. Methodology</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Methodology.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="literature-review" class="level2">
<h2 class="anchored" data-anchor-id="literature-review">5. Literature Review</h2>
<p>We analyzed six research articles in relation to our project topic:</p>
<p>1) &nbsp;Climatic influence on electricity consumption: The case of Singapore and Hong Kong - Singapore’s yearly electricity consumption may rise by 3-4% for every degree Celsius that the temperature rises, with the residential sector bearing most of the increase. Singapore’s major electricity user, with less seasonality than Hong Kong, is the industrial sector. The overall fluctuation is generally low, while the demand for power is higher in the commercial and residential sectors during the hotter months. The impact of temperature variations on power usage is assessed using two analytical techniques in this study: the time-series approach (uses monthly data from 1990 to 2015) and the decomposition approach (divides consumption into trend, seasonal, cyclical, and irregular components). The findings indicate that, while temperature has a statistically significant impact on energy use, particularly in the residential sector, the total effect is not as strong as it is in Hong Kong.</p>
<p>2) Impact of climate change and socioeconomic factors on domestic energy consumption: The case of Hong Kong and Singapore -&nbsp; The study examines Singapore’s energy usage using LMG (Lindeman, Merenda, and Gold Method) and PMVD (Proportional Marginal Variance Decomposition) techniques, and it finds that climatic factors such as the heat index and monsoon have a greater impact than population and GDP. According to the Generalized Additive Model (log-transformed to account for non-linear relationships) for Energy Consumption, humidity and temperature increase rather than decrease energy consumption. Using six CMIP5 models, future climate forecasts forecast higher energy demand, particularly in the residential sector. By 2100, Singapore’s environment is expected to stay tropical rainforest and extend north which could change the regional energy trends.</p>
<p>3) Impact of climate change on dengue fever epidemics in South and Southeast Asian settings: A modelling study -</p>
<p>The study examines dengue transmission in Singapore using an SEI-SEIR (Susceptible-Exposed-Infected-Recovered) model. To account for temperature-dependent characteristics including bite rate, extrinsic incubation period, and mosquito mortality rate, it divides human and mosquito populations into several stages of infection. Future temperatures and precipitation under three climate change scenarios are simulated using climate models from Phase 6 of the Coupled Model Intercomparison Project (CMIP6). Dengue forecasts for Singapore are based on daily rainfall and temperature data from 2012 to 2020. The most important temperature-dependent parameters were identified by uncertainty and sensitivity analysis, which revealed that dengue transmission is greatly enhanced by higher mosquito biting frequency and lower death in ideal warm conditions.</p>
<p>4) Impact of extreme weather on dengue fever infection in four Asian countries: A modelling analysis -</p>
<p>The paper analyzes dengue risk in each study location using a distributed lag nonlinear model (DLNM) and a two-stage meta-analysis. The DLNM accounts for nonlinear connections by capturing the delayed impacts of rainfall and temperature on dengue risk. To account for overdispersion of dengue cases, the study uses a Generalized Linear Model (GLM) with a quasi-Poisson Distribution. Public holidays, humidity, wind speed, rainfall, and temperature are examples of independent variables. For regional adjustment, the Best Linear Unbiased Prediction (BLUP) methodology is employed, which reduces estimation errors and yields more trustworthy country-specific results by enabling smaller sample sites to draw strength from bigger datasets.</p>
<p>5) A Review and Case Analysis of the Impact of Weather Factors on Public Transportation in Singapore - The study investigates how weather factors affect the efficiency of transportation. High temperatures increase the number of passengers on the MRT, and heavy rains results in lengthier bus wait times, according to a Pearson correlation test. A multivariate linear regression model measures how each weather variable affects the effectiveness of public transportation. Demand patterns are impacted by temperature, while delays are most affected by rainfall. Bus and train delays are predicted with good accuracy (approx. 85%) via a Random Forest machine learning algorithm.</p>
</section>
<section id="prototype" class="level2">
<h2 class="anchored" data-anchor-id="prototype">6. Prototype</h2>
<p>Click <a href="https://dewschan.shinyapps.io/Grp7_Shiny/">here</a> to project’s prototype Shiny App.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>